

test-obj: [spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4649364276567162656B576A3B20657870697265733D
4672692C2032382D4665622D323031342030343A35353A333420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35353A333420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35353A
333320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383835342C227379
6E63223A313337373636353733342C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D44346A6844506B4D4D454A353B20657870697265733D
4672692C2032382D4665622D323031342030343A35353A343020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35353A343020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35353A
333920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383835352C227379
6E63223A313337373636353734302C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6C505A5965716566393071333B20657870697265733D
4672692C2032382D4665622D323031342030343A35353A343220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35353A343220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35353A
343120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383835352C227379
6E63223A313337373636353734322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D413234446A576D7050554F443B20657870697265733D
4672692C2032382D4665622D323031342030343A35353A343420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35353A343420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35353A
343320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383835352C227379
6E63223A313337373636353734342C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6D566576447A5258745561423B20657870697265733D
4672692C2032382D4665622D323031342030343A35353A343620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35353A343620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35353A
343620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383835362C227379
6E63223A313337373636353734362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7246616A42653739373032773B20657870697265733D
4672692C2032382D4665622D323031342030343A35353A343820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35353A343820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35353A
343820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383835382C227379
6E63223A313337373636353734382C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6B7564695545376A754575633B20657870697265733D
4672692C2032382D4665622D323031342030343A35353A353020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35353A353020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35353A
353020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383835382C227379
6E63223A313337373636353735302C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D30636530316C4839363057533B20657870697265733D
4672692C2032382D4665622D323031342030343A35353A353320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35353A353320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35353A
353220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383836312C227379
6E63223A313337373636353735332C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D766839624B59696E6A3047583B20657870697265733D
4672692C2032382D4665622D323031342030343A35353A353520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35353A353520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35353A
353420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383836322C227379
6E63223A313337373636353735352C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3250384F71686F654543566E3B20657870697265733D
4672692C2032382D4665622D323031342030343A35353A353720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35353A353720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35353A
353620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383836322C227379
6E63223A313337373636353735372C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D667A777937544673306B79543B20657870697265733D
4672692C2032382D4665622D323031342030343A35353A353920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35353A353920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35353A
353920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383836352C227379
6E63223A313337373636353735392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D787231365A42574D6B5574573B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A303120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A303120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
303120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383836372C227379
6E63223A313337373636353736312C226D73223A327D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5A6E37707A49455667304B623B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A303420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A303420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
303320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383836372C227379
6E63223A313337373636353736342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7339617250524875775553513B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A303620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A303620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
303520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383839332C227379
6E63223A313337373636353736362C226D73223A31307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3136786D64326F76416B61583B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A303820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A303820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
303720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383839332C227379
6E63223A313337373636353736382C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D725339594768574F314569643B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A313020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A313020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
303920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383839332C227379
6E63223A313337373636353737302C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D37484734485547355543715A3B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A313220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A313220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
313220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383839332C227379
6E63223A313337373636353737322C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D76753136514C364B386B617A3B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A313520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A313520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
313420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383839352C227379
6E63223A313337373636353737352C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D533531714C7877786B75746E3B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A313720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A313720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
313620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383839352C227379
6E63223A313337373636353737372C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D726B75736A49766A69556D663B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A313920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A313920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
313820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383839362C227379
6E63223A313337373636353737392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D75747545666A6E427545694B3B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A323120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A323120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
323020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383839362C227379
6E63223A313337373636353738312C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D30625377566B5766654532323B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A323320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A323320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
323220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383839392C227379
6E63223A313337373636353738332C226D73223A327D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D633356366434324743556D4A3B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A323520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A323520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
323520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383839392C227379
6E63223A313337373636353738352C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D705558416E4962496B7870663B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A323820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A323820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
323720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930312C227379
6E63223A313337373636353738382C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D645766476B667132446B75453B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A333020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A333020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
323920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930322C227379
6E63223A313337373636353739302C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6563506E5A5A74485945534D3B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A333220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A333220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
333120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930322C227379
6E63223A313337373636353739322C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3358706E766B7134693036653B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A333420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A333420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
333320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930332C227379
6E63223A313337373636353739342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D47734736597047526E4547543B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A333620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A333620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
333520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930332C227379
6E63223A313337373636353739362C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4A723030526A4265334532363B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A333820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A333820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
333820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930332C227379
6E63223A313337373636353739382C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6C6D374C475A686B657672513B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A343120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A343120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
343020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930332C227379
6E63223A313337373636353830312C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D773268466E436372413043643B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A343320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A343320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
343220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930332C227379
6E63223A313337373636353830332C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D526E79645262524745754A513B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A343520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A343520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
343420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930332C227379
6E63223A313337373636353830352C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D75745A7737314E66775575383B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A343720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A343720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
343620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930332C227379
6E63223A313337373636353830372C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D396D496746764A4F34556D6E3B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A343920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A343920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
343920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930332C227379
6E63223A313337373636353830392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D69475738645478383079576D3B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A353120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A353120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
353120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930332C227379
6E63223A313337373636353831312C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7648546A48554E436B4F44573B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A353420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A353420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
353320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930342C227379
6E63223A313337373636353831342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D50784C4A4D565773685547573B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A353620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A353620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
353520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930342C227379
6E63223A313337373636353831362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D66636461596C4A616D5569413B20657870697265733D
4672692C2032382D4665622D323031342030343A35363A353820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35363A353820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
353720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383930392C227379
6E63223A313337373636353831382C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3145447475585556356B364D3B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A303020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A303020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35363A
353920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383931362C227379
6E63223A313337373636353832302C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D484E35424E637733556B75453B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A303220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A303220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
303220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383931362C227379
6E63223A313337373636353832322C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4D486438647A4C4B316B32573B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A303520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A303520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
303420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383931362C227379
6E63223A313337373636353832352C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4676584C7645456A72456D723B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A303720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A303720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
303620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383931372C227379
6E63223A313337373636353832372C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D457237436D4733463345755A3B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A303920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A303920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
303820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383931372C227379
6E63223A313337373636353832392C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D67524A50446833794F6B57793B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A313120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A313120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
313020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383931392C227379
6E63223A313337373636353833312C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D30624166474348326C5545323B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A313320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A313320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
313220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383931392C227379
6E63223A313337373636353833332C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6E3052784D426232686B4B573B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A313520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A313520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
313520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383932322C227379
6E63223A313337373636353833352C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D47494E686A36314B4A6B4F6F3B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A313820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A313820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
313720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383932322C227379
6E63223A313337373636353833382C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4A313347644B334F433071363B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A323020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A323020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
313920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383932342C227379
6E63223A313337373636353834302C226D73223A31387D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D48666445794F73557164544E3B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A323220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A323220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
323120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383932342C227379
6E63223A313337373636353834322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D46316545356B3962355561583B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A323420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A323420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
323320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383932362C227379
6E63223A313337373636353834342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4C53685670674B4D6B7939693B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A323620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A323620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
323520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383932362C227379
6E63223A313337373636353834362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6579564B79566341385543543B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A323820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A323820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
323820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383932362C227379
6E63223A313337373636353834382C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4B6F3247346C48654A6B4F373B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A333120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A333120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
333020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383932372C227379
6E63223A313337373636353835312C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D58774B38417266304B6B61643B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A333320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A333320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
333220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383932382C227379
6E63223A313337373636353835332C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D487558594639546C356B4B613B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A333520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A333520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
333420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383932382C227379
6E63223A313337373636353835352C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6A6E3045303954486855696F3B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A333720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A333720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
333620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383932392C227379
6E63223A313337373636353835372C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D33526632334F7466794561333B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A333920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A333920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
333820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383932392C227379
6E63223A313337373636353835392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D566F30347363474A774569753B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A343120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A343120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
343120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383932392C227379
6E63223A313337373636353836312C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6B456B78625747774C3032703B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A343420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A343420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
343320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383933312C227379
6E63223A313337373636353836342C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6F50464D5A7255506B304F553B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A343620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A343620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
343520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383933322C227379
6E63223A313337373636353836362C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4544425347744A6B75704B733B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A343820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A343820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
343720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383933352C227379
6E63223A313337373636353836382C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D71396A4C303538654E5561543B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A353020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A353020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
343920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383933352C227379
6E63223A313337373636353837302C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D49484E6D44704244415575343B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A353220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A353220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
353120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383933352C227379
6E63223A313337373636353837322C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6A6E4E6E4E514450456D77423B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A353520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A353520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
353520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383933352C227379
6E63223A313337373636353837352C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D317A557958465543696B5A593B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A353720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A353720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
353720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383933362C227379
6E63223A313337373636353837372C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4E5441585A727157486B616D3B20657870697265733D
4672692C2032382D4665622D323031342030343A35373A353920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35373A353920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35373A
353920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383933392C227379
6E63223A313337373636353837392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D574D354E734277327255537A3B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A303120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A303120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
303120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383934302C227379
6E63223A313337373636353838312C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D736866396C79656F67304F763B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A303320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A303320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
303320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383934302C227379
6E63223A313337373636353838332C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D776D46734664717A72456D423B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A303520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A303520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
303520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383934302C227379
6E63223A313337373636353838352C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D48477A736F726C33556162503B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A303820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A303820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
303820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383934302C227379
6E63223A313337373636353838382C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D49614F4C4B457835515553723B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A313020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A313020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
313020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383934332C227379
6E63223A313337373636353839302C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D685261725038534A304F6C343B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A313220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A313220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
313220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383934332C227379
6E63223A313337373636353839322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D396F59564A70446250554B463B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A313420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A313420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
313420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383934332C227379
6E63223A313337373636353839342C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4151646C554E3579456B4F6F3B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A313620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A313620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
313620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383934342C227379
6E63223A313337373636353839362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4B56776B67584A45784536313B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A313920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A313920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
313920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383934342C227379
6E63223A313337373636353839392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D493976463937526466306D4F3B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A323120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A323120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
323120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383934352C227379
6E63223A313337373636353930312C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4D3569476D73316F306578413B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A323320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A323320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
323320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383934362C227379
6E63223A313337373636353930332C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D376B656A4351336A4230435A3B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A323520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A323520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
323520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383934372C227379
6E63223A313337373636353930352C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3076527261376E42307556493B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A323720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A323720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
323720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383934372C227379
6E63223A313337373636353930372C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D574F435A5A303868586B30483B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A333020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A333020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
333020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383934382C227379
6E63223A313337373636353931302C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D51554A32776C33324A304B423B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A333220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A333220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
333220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383935302C227379
6E63223A313337373636353931322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D65786F6F5844624E4E6B4F693B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A333420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A333420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
333420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383935312C227379
6E63223A313337373636353931342C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4C7367685658316F454F45503B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A333620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A333620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
333620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383935322C227379
6E63223A313337373636353931362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4945366D795049614630477A3B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A333820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A333820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
333820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383935352C227379
6E63223A313337373636353931382C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4842713767344F664F4536503B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A343120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A343120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
343120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383935352C227379
6E63223A313337373636353932312C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D734874676259336E45794B4C3B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A343320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A343320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
343320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383935352C227379
6E63223A313337373636353932332C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D58367235774E41486A4553793B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A343520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A343520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
343520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383935352C227379
6E63223A313337373636353932352C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D713768737364574456454B703B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A343720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A343720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
343720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383935352C227379
6E63223A313337373636353932372C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4A42583936753461457575443B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A353020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A353020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
343920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383935352C227379
6E63223A313337373636353933302C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D464D336254394557454246673B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A353220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A353220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
353220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383935362C227379
6E63223A313337373636353933322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4A6A4F5462697659746B75763B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A353420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A353420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
353420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383935372C227379
6E63223A313337373636353933342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3633376D4C6370726245794C3B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A353620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A353620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
353620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383936302C227379
6E63223A313337373636353933362C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4D6D413978324D417155796A3B20657870697265733D
4672692C2032382D4665622D323031342030343A35383A353920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35383A353920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35383A
353820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383936302C227379
6E63223A313337373636353933392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D524B6677566E4D49653043343B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A303120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A303120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
303120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383936302C227379
6E63223A313337373636353934312C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D52487742576749547455796A3B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A303320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A303320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
303320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383936302C227379
6E63223A313337373636353934332C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6C6D7476556252564E45796E3B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A303520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A303520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
303520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383936302C227379
6E63223A313337373636353934352C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3551464B63356F65443079453B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A303720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A303720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
303720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383936302C227379
6E63223A313337373636353934372C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D464E764470384157303265483B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A313020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A313020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
303920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383936302C227379
6E63223A313337373636353935302C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3134614F36544C4F6B7155693B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A313220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A313220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
313220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383936302C227379
6E63223A313337373636353935322C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D594D7A4D624E56624D304F4B3B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A313420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A313420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
313420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383936312C227379
6E63223A313337373636353935342C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6E586A6E4C4F333764556D4F3B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A313620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A313620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
313620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383936322C227379
6E63223A313337373636353935362C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D644D546F685561454745724E3B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A313820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A313820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
313820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383936392C227379
6E63223A313337373636353935382C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3577665743557534754557383B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A323220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A323220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
323120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383937302C227379
6E63223A313337373636353936322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3072736C75434D46496B36613B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A323420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A323420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
323420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383937302C227379
6E63223A313337373636353936342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6A504D735A7A314B5A4547623B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A323620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A323620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
323620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383937302C227379
6E63223A313337373636353936362C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4D69654354686F73574532583B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A323820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A323820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
323820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383937312C227379
6E63223A313337373636353936382C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6C326B38696850465855434E3B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A333020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A333020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
333020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383937312C227379
6E63223A313337373636353937302C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D38615062463478456B5547463B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A333320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A333320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
333320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383937312C227379
6E63223A313337373636353937332C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D327441666D37366B585543533B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A333520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A333520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
333520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383937312C227379
6E63223A313337373636353937352C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D67644953776D54576B3634363B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A333720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A333720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
333720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383937322C227379
6E63223A313337373636353937372C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D53624748674765707A4578743B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A343020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A343020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
343020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383937342C227379
6E63223A313337373636353938302C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D51746E7041526F69473043693B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A343220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A343220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
343220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D5D2C2274696D65223A32323830383937362C227379
6E63223A313337373636353938322C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6556334369693577593075463B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A343420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A343420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
343420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830383938302C
2273796E63223A313337373636353938342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D76693950346636436B794B713B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A343620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A343620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
343620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830383938332C
2273796E63223A313337373636353938362C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5733646C6D4D76766B55474A3B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A343920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A343920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
343820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830383938332C
2273796E63223A313337373636353938392C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D364836795246655950556D4F3B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A353220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A353220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
353120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830383938332C
2273796E63223A313337373636353939322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D55686B6E6E346236454B38693B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A353420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A353420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
353420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830383938342C
2273796E63223A313337373636353939342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4E64574F69625469703032313B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A353620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A353620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
353620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830383938362C
2273796E63223A313337373636353939362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6C6A444F557771386330486B3B20657870697265733D
4672692C2032382D4665622D323031342030343A35393A353820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030343A35393A353820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030343A35393A
353820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830383939302C
2273796E63223A313337373636353939382C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4E36375964745A50385571623B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A303120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A303120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
303020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830383939312C
2273796E63223A313337373636363030312C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7531334F78476D6153456D733B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A303320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A303320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
303220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830383939322C
2273796E63223A313337373636363030332C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D506A774B545336764F4557413B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A303520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A303520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
303520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830383939342C
2273796E63223A313337373636363030352C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5034745875454966556935413B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A303720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A303720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
303720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830383939372C
2273796E63223A313337373636363030372C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4F5A63434C4F6159686B706E3B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A313020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A313020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
303920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830383939382C
2273796E63223A313337373636363031302C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D665842715367567641454F493B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A313220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A313220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
313120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830383939392C
2273796E63223A313337373636363031322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7745394448726D4C745547703B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A313420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A313420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
313420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830383939392C
2273796E63223A313337373636363031342C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D756D357247454872554B6D393B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A313620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A313620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
313620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830393031302C
2273796E63223A313337373636363031362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D55573055444F316B643043363B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A313820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A313820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
313820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830393031302C
2273796E63223A313337373636363031382C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4359673859757564736B53313B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A323120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A323120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
323020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830393031302C
2273796E63223A313337373636363032312C226D73223A377D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D344E746A534376716B3254593B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A323320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A323320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
323320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313338320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343335372C22636F6E74656E74223A22536F2C20646F776E6C6F616420
6472206D656D6F727920616E642075736520697420746F2072756E2074686520
72332E657865203F2020416E6420746861745C75303032362333393B73206974
3F222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363239392C226D6573736167655F656469747322
3A317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D
70223A313337373636343533362C22636F6E74656E74223A22546F2075736520
69742C20796F75206472616720746865206578652066696C65206F6E746F2074
68652064722E6D656D6F727920657865222C22757365725F6964223A32353632
3731312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F
6964223A3239312C226D6573736167655F6964223A31313437363333317D2C0D
0A7B226576656E745F74797065223A312C2274696D655F7374616D70223A3133
37373636343534392C22636F6E74656E74223A2269742070757473206C6F6773
20696E202F757365722F617070646174612F726F616D696E672F64726D656D6F
7279222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363333332C226D6573736167655F6564697473223A
317D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D70
223A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E
6720746F2074727920636F6D6D616E64206C696E6520736F207265626F6F7469
6E67222C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D6573
736167655F6964223A31313437363334357D2C0D0A7B226576656E745F747970
65223A312C2274696D655F7374616D70223A313337373636353632342C22636F
6E74656E74223A224047726168616D436869752069732074686973206120636C
6F73656420736F75726365207363726970743F206973206974206F6B20696620
4920646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D7920
74657374696E673F222C22757365725F6964223A323536323731312C22757365
725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C
226D6573736167655F6964223A31313437363532312C22706172656E745F6964
223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C2274
696D655F7374616D70223A313337373636353938342C22636F6E74656E74223A
22406B65616C697374204E6F2C2069745C75303032362333393B732074616B65
6E2066726F6D206D7920676974687562207265706F2066726F6D2061206C6172
67657220736372697074222C226964223A32323830383937392C22757365725F
6964223A37363835322C22757365725F6E616D65223A2247726168616D204368
6975222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A225B
5265626F6C20616E64205265645D222C226D6573736167655F6964223A313134
37363539362C22706172656E745F6964223A31313437363532312C2273686F77
5F706172656E74223A747275657D5D2C2274696D65223A32323830393031312C
2273796E63223A313337373636363032332C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6F42486C6E596E65713031443B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A323520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A323520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
323520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393031332C2273796E63223A313337373636363032352C
226D73223A327D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D48363663694C715958554B753B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A323820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A323820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
323720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393031332C2273796E63223A313337373636363032382C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4267515962395A6A6B6971313B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A333020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A333020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
333020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393031332C2273796E63223A313337373636363033302C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D726A3763525976474B4561323B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A333220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A333220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
333220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393031352C2273796E63223A313337373636363033322C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5957615754646F784C304F513B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A333420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A333420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
333420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393031352C2273796E63223A313337373636363033342C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D615834426630636B61304B7A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A333720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A333720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
333620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393031372C2273796E63223A313337373636363033372C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D377A4E334A633672594548313B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A333920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A333920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
333820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393031372C2273796E63223A313337373636363033392C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5668446F736332506F6B58393B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A343120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A343120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
343120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393031372C2273796E63223A313337373636363034312C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5941665657735A74374565313B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A343320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A343320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
343320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393031372C2273796E63223A313337373636363034332C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D73314E3241466A343930615A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A343620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A343620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
343520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393031372C2273796E63223A313337373636363034362C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D553136645964514571685A633B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A343820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A343820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
343720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393031372C2273796E63223A313337373636363034382C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D75725A70354A4257386B476A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A353020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A353020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
353020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393031372C2273796E63223A313337373636363035302C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6B6878625A616E54554F79653B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A353220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A353220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
353220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393031372C2273796E63223A313337373636363035322C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6143304A47633846556D31493B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A353520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A353520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
353420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393031392C2273796E63223A313337373636363035352C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7345524F704562636E3043363B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A353720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A353720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
353620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393032302C2273796E63223A313337373636363035372C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D315A783132614658703047783B20657870697265733D
4672692C2032382D4665622D323031342030353A30303A353920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30303A353920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30303A
353920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393032312C2273796E63223A313337373636363035392C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4638354A6F577358706B71373B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A303120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A303120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
303120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393032332C2273796E63223A313337373636363036312C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5A4752644A534E72523036493B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A303420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A303420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
303320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393032342C2273796E63223A313337373636363036342C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D566B5539464D6E366B4F38583B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A303620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A303620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
303520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033302C2273796E63223A313337373636363036362C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D78503456334F39356C5575443B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A303820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A303820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
303820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033312C2273796E63223A313337373636363036382C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6935444B47563652557152473B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A313020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A313020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
313020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033322C2273796E63223A313337373636363037302C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D66663477685A55694B3065773B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A313320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A313320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
313220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033322C2273796E63223A313337373636363037332C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D796C45516A68377744556D7A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A313520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A313520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
313420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033322C2273796E63223A313337373636363037352C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D516A7648523165796B7133653B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A313720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A313720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
313720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033322C2273796E63223A313337373636363037372C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D48365459574E57586D6B4F433B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A313920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A313920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
313920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033322C2273796E63223A313337373636363037392C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D766944726833414C6B6B36493B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A323220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A323220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
323120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033322C2273796E63223A313337373636363038322C
226D73223A367D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D633779756A71474E336B69733B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A323420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A323420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
323320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033322C2273796E63223A313337373636363038342C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7A57503456737A64306574613B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A323620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A323620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
323620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033322C2273796E63223A313337373636363038362C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D756847654C574E35435547593B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A323820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A323820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
323820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033322C2273796E63223A313337373636363038382C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D774C465A4C46374B42306D703B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A333120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A333120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
333020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033322C2273796E63223A313337373636363039312C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D305334537639596F45656B333B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A333320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A333320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
333220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033352C2273796E63223A313337373636363039332C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6149527377394D66706B576F3B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A333520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A333520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
333520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033362C2273796E63223A313337373636363039352C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D683043394B36335267456D663B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A333720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A333720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
333720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033362C2273796E63223A313337373636363039372C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D38436B4C72654E7330326B673B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A343020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A343020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
333920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393033362C2273796E63223A313337373636363130302C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4830613037543758304F62793B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A343220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A343220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
343120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393034302C2273796E63223A313337373636363130322C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D43416131665755783945367A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A343420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A343420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
343420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393034312C2273796E63223A313337373636363130342C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5735663565554D4C673044533B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A343620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A343620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
343620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393034332C2273796E63223A313337373636363130362C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6D4F717658515A6969554B303B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A343920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A343920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
343820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393034332C2273796E63223A313337373636363130392C
226D73223A377D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D63434378346E69346B5334413B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A353120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A353120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
353120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393034332C2273796E63223A313337373636363131312C
226D73223A337D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D57444B7477754B503730365A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A353320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A353320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
353320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393034342C2273796E63223A313337373636363131332C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5231625A786B6376775565463B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A353620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A353620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
353520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393034352C2273796E63223A313337373636363131362C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D716556626D6B6E533045475A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30313A353820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30313A353820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30313A
353720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393034382C2273796E63223A313337373636363131382C
226D73223A347D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4137384F72453671515547613B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A303020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A303020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
303020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393035302C2273796E63223A313337373636363132302C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D613137656972507A6B6138703B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A303220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A303220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
303220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393035352C2273796E63223A313337373636363132322C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6442464A3047374C304257313B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A303520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A303520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
303420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393035382C2273796E63223A313337373636363132352C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3963574177313074363043723B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A303720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A303720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
303620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393035382C2273796E63223A313337373636363132372C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4B4974574E7076515530504A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A303920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A303920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
303920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393035382C2273796E63223A313337373636363132392C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5A39504D6F553535755547343B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A313120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A313120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
313120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393035382C2273796E63223A313337373636363133312C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D673372394E593049423061523B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A313420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A313420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
313320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393035382C2273796E63223A313337373636363133342C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7A6D4737726A784F566B75433B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A313620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A313620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
313520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393036302C2273796E63223A313337373636363133362C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4C64596D744C3442556D46643B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A313820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A313820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
313820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393036332C2273796E63223A313337373636363133382C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D566B3749454736616E55326F3B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A323020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A323120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
323020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393036332C2273796E63223A313337373636363134312C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D447235366B6C3963346B574D3B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A323320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A323320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
323220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393036332C2273796E63223A313337373636363134332C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4F4A6C7630793377453233363B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A323520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A323520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
323420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393036342C2273796E63223A313337373636363134352C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3465625262485651306D79443B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A323720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A323720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
323720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393036342C2273796E63223A313337373636363134372C
226D73223A327D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D43425773303372465230436D3B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A333020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A333020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
323920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393036342C2273796E63223A313337373636363135302C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4F7335577A5432357045574B3B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A333220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A333220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
333120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393036362C2273796E63223A313337373636363135322C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5569446559575648454B38683B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A333420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A333420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
333420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393036362C2273796E63223A313337373636363135342C
226D73223A31397D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6F513343396F4A744C6B57383B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A333620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A333620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
333620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393036372C2273796E63223A313337373636363135362C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4A4D6B776C4C746B746B6D7A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A333920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A333920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
333820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393036382C2273796E63223A313337373636363135392C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D307269444C443332705550773B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A343120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A343120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
343020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393036392C2273796E63223A313337373636363136312C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D62324A773566506E696B43713B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A343320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A343320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
343320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393036392C2273796E63223A313337373636363136332C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7378674245475A6966454B523B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A343520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A343520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
343520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393037302C2273796E63223A313337373636363136352C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D654F726C63616861306D54433B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A343820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A343820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
343720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393037322C2273796E63223A313337373636363136382C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D52516F5A55564B50453238633B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A353020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A353020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
343920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393037322C2273796E63223A313337373636363137302C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D464A3633526B71555830714D3B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A353220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A353220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
353220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393037322C2273796E63223A313337373636363137322C
226D73223A337D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D554A70346F7A384D756B32413B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A353520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A353520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
353420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393037322C2273796E63223A313337373636363137352C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D43643732486153316E6B4B4F3B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A353720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A353720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
353620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393037332C2273796E63223A313337373636363137372C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D31427230703570577530576C3B20657870697265733D
4672692C2032382D4665622D323031342030353A30323A353920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30323A353920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30323A
353920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393037332C2273796E63223A313337373636363137392C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D496B5A6C67623834554B6C583B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A303120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A303120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
303120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393037332C2273796E63223A313337373636363138312C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4A66736A50376D6C716B61393B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A303420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A303420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
303320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393037332C2273796E63223A313337373636363138342C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6752544F6E753452496B79663B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A303620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A303620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
303520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393037342C2273796E63223A313337373636363138362C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D634A306F34315171343036613B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A303820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A303820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
303820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393037352C2273796E63223A313337373636363138382C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D595459344C367155305547513B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A313120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A313120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
313020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393037352C2273796E63223A313337373636363139312C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4B7631483141786A556B4F503B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A313320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A313320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
313220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393037352C2273796E63223A313337373636363139332C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4A5A70536B3371716B4536743B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A313520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A313520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
313520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393038312C2273796E63223A313337373636363139352C
226D73223A327D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D516A6938416C54556530656E3B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A313820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A313820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
313720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393038332C2273796E63223A313337373636363139382C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D594E354A7578556B585557463B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A323020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A323020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
313920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393038332C2273796E63223A313337373636363230302C
226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D636D5932763735345532314B3B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A323220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A323220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
323120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313130380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D5D2C2274
696D65223A32323830393038342C2273796E63223A313337373636363230322C
226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D585549666A5053496E6B61343B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A323420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A323420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
323420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393038
362C2273796E63223A313337373636363230342C226D73223A347D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D55557158394B54473053717A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A323720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A323720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
323620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393038
372C2273796E63223A313337373636363230372C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D716F7535696C344F6B6B4B503B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A323920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A323920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
323820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393038
372C2273796E63223A313337373636363230392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4C5A64744930674A764575543B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A333120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A333120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
333120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393038
392C2273796E63223A313337373636363231312C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7658594F73625951764579753B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A333420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A333420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
333320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393039
302C2273796E63223A313337373636363231342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3449787856554D566B476A653B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A333620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A333620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
333520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393039
302C2273796E63223A313337373636363231362C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3862496B52646D78454557323B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A333820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A333820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
333720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393039
312C2273796E63223A313337373636363231382C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D615978596D5A325245366F6D3B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A343020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A343020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
343020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393039
332C2273796E63223A313337373636363232302C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D69444C773952584C304F4F4B3B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A343320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A343320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
343220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393039
342C2273796E63223A313337373636363232332C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3867385765325361373036373B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A343520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A343520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
343420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393039
352C2273796E63223A313337373636363232352C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D624E584868764D6B4B4D374A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A343720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A343720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
343620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393039
352C2273796E63223A313337373636363232372C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6B3871375172793139304B753B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A353020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A353020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
343920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393039
352C2273796E63223A313337373636363233302C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D57495836625A4754674561633B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A353220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A353220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
353120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393039
352C2273796E63223A313337373636363233322C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4743625774514D38307178393B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A353420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A353420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
353320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393039
382C2273796E63223A313337373636363233342C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3876355743496757493079573B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A353620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A353620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
353620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393130
312C2273796E63223A313337373636363233362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D497868647A6164505532736A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30333A353920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30333A353920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30333A
353820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393130
362C2273796E63223A313337373636363233392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D586C59364F6E4E494A6B65313B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A303120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A303120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
303020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393130
362C2273796E63223A313337373636363234312C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7164496E3564734532454E473B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A303320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A303320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
303320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393130
362C2273796E63223A313337373636363234332C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6255414565636F345A5571373B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A303620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A303620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
303520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393130
382C2273796E63223A313337373636363234362C226D73223A337D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D593467595750324D56454B4E3B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A303820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A303820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
303720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393130
392C2273796E63223A313337373636363234382C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4C34644650527251436B53663B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A313020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A313020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
303920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393130
392C2273796E63223A313337373636363235302C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D373246676766536F4F6B79473B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A313320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A313320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
313220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393131
312C2273796E63223A313337373636363235332C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D326B4964514B4A54414553673B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A313520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A313520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
313420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393131
322C2273796E63223A313337373636363235352C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4A4B57525064485A6E6B71613B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A313720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A313720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
313620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393131
332C2273796E63223A313337373636363235372C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7964394F513373396A45694E3B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A313920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A313920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
313920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393131
332C2273796E63223A313337373636363235392C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5068756254587251593061673B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A323220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A323220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
323120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393131
332C2273796E63223A313337373636363236322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5556533874366A7A7A5557363B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A323420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A323420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
323320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393131
342C2273796E63223A313337373636363236342C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4E37673757524B45385532303B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A323620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A323620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
323620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313332300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343533362C22636F6E74656E74223A22546F207573652069742C20796F
75206472616720746865206578652066696C65206F6E746F207468652064722E
6D656D6F727920657865222C22757365725F6964223A323536323731312C2275
7365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239
312C226D6573736167655F6964223A31313437363333317D2C0D0A7B22657665
6E745F74797065223A312C2274696D655F7374616D70223A3133373736363435
34392C22636F6E74656E74223A2269742070757473206C6F677320696E202F75
7365722F617070646174612F726F616D696E672F64726D656D6F7279222C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C226D6573736167655F696422
3A31313437363333332C226D6573736167655F6564697473223A317D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F2074
727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C2275
7365725F6964223A37363835322C22757365725F6E616D65223A224772616861
6D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F69
64223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C22
74696D655F7374616D70223A313337373636353632342C22636F6E74656E7422
3A224047726168616D436869752069732074686973206120636C6F7365642073
6F75726365207363726970743F206973206974206F6B206966204920646F2073
6F6D652076657273696F6E20636F6E74726F6C206F66206D792074657374696E
673F222C22757365725F6964223A323536323731312C22757365725F6E616D65
223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D65737361
67655F6964223A31313437363532312C22706172656E745F6964223A31313437
363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636353938342C22636F6E74656E74223A22406B65616C
697374204E6F2C2069745C75303032362333393B732074616B656E2066726F6D
206D7920676974687562207265706F2066726F6D2061206C6172676572207363
72697074222C22757365725F6964223A37363835322C22757365725F6E616D65
223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C226D
6573736167655F6964223A31313437363539362C22706172656E745F6964223A
31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A7B
226576656E745F74797065223A312C2274696D655F7374616D70223A31333737
3636363230332C22636F6E74656E74223A22476F7420612073797374656D2065
72726F7220233134303520746869732074696D65222C226964223A3232383039
3038352C22757365725F6964223A37363835322C22757365725F6E616D65223A
2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22726F6F
6D5F6E616D65223A225B5265626F6C20616E64205265645D222C226D65737361
67655F6964223A31313437363634397D5D2C2274696D65223A32323830393131
352C2273796E63223A313337373636363236362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D376356797445306A32554F503B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A323920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A323920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
323820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313039300D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393131372C2273796E63
223A313337373636363236392C226D73223A31377D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6F444C6A6A794973424565673B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A333120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A333120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
333020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393131382C2273796E63
223A313337373636363237312C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D584D6852786F646C506B4F4C3B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A333320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A333320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
333320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393131392C2273796E63
223A313337373636363237332C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D583862794B68616F6B3075703B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A333620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A333620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
333520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393132302C2273796E63
223A313337373636363237362C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D456B79576C5A394A655561723B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A333820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A333820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
333720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393132302C2273796E63
223A313337373636363237382C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6243534E63374868544553373B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A343020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A343020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
333920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393132302C2273796E63
223A313337373636363238302C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D524E32504C71366879454F703B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A343320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A343320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
343220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393132302C2273796E63
223A313337373636363238332C226D73223A387D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5969337170655676505571503B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A343520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A343520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
343420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393132312C2273796E63
223A313337373636363238352C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D374C46434F643075454C396B3B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A343720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A343720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
343620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393132312C2273796E63
223A313337373636363238372C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D44776E633637796674554C6A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A353020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A353020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
343920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393132322C2273796E63
223A313337373636363239302C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D72457A766A54687554554B453B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A353220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A353220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
353120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393132332C2273796E63
223A313337373636363239322C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D65467A7370415572655579623B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A353420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A353420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
353320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393132352C2273796E63
223A313337373636363239342C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D71556D555173474C45717A633B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A353620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A353620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
353620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393132362C2273796E63
223A313337373636363239362C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D31414554357756497045474C3B20657870697265733D
4672692C2032382D4665622D323031342030353A30343A353920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30343A353920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30343A
353820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393132382C2273796E63
223A313337373636363239392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D724A73526A494436457147343B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A303120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A303120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
303020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393132392C2273796E63
223A313337373636363330312C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D64386D33444B46717A55506D3B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A303320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A303320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
303320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313038390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D5D2C2274696D65223A32323830393132392C2273796E63
223A313337373636363330332C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D327A65443243324D533032413B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A303620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A303620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
303520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393133302C2273796E63223A
313337373636363330362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4E586C43754737736145365A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A303820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A303820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
303720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393133312C2273796E63223A
313337373636363330382C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4D59636462695A43457559573B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A313020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A313020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
313020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393133312C2273796E63223A
313337373636363331302C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3339675139704A526B4F66563B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A313320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A313320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
313220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393133332C2273796E63223A
313337373636363331332C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6747524E7255596C536B32753B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A313520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A313520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
313420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393133332C2273796E63223A
313337373636363331352C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D655234444A6737504B454F493B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A313720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A313720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
313620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393133342C2273796E63223A
313337373636363331372C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4568517442767459305739453B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A323020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A323020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
313920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393133362C2273796E63223A
313337373636363332302C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D557836394A49685365454F643B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A323220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A323220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
323120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393133382C2273796E63223A
313337373636363332322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4A70345968634A305A6B61653B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A323420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A323420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
323320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393134302C2273796E63223A
313337373636363332342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7445435A704D4D34614579623B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A323720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A323720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
323620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393134302C2273796E63223A
313337373636363332372C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D45464D6573625031376B32533B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A323920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A323920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
323820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393134302C2273796E63223A
313337373636363332392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6573524933586D66624565363B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A333120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A333120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
333020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393134322C2273796E63223A
313337373636363333312C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D50356964394F654E516B43423B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A333420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A333420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
333320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393134322C2273796E63223A
313337373636363333342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D396B7271794A7246556569523B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A333620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A333620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
333520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393134342C2273796E63223A
313337373636363333362C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D434A796B414E4257436B437A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A333820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A333820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
333720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393134352C2273796E63223A
313337373636363333382C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D38656751686C6363554B4A563B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A343120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A343120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
343020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393134352C2273796E63223A
313337373636363334312C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3544374B7374345179554B613B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A343320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A343320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
343220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393134352C2273796E63223A
313337373636363334332C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7365564661597451306B716A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A343520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A343520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
343420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393134382C2273796E63223A
313337373636363334352C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4B5955416C78714B386B6D343B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A343820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A343820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
343720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393134382C2273796E63223A
313337373636363334382C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7363543356756A614F4565623B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A353020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A353020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
343920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393134392C2273796E63223A
313337373636363335302C226D73223A337D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4C7372726C67514E7855716D3B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A353220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A353220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
353120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393135322C2273796E63223A
313337373636363335322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4D67367666586C594F5579423B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A353520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A353520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
353420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393135342C2273796E63223A
313337373636363335352C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D67423854695748346A45614E3B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A353720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A353720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
353620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393135342C2273796E63223A
313337373636363335372C226D73223A377D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7A6971554F77496D5A556D673B20657870697265733D
4672692C2032382D4665622D323031342030353A30353A353920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30353A353920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30353A
353820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393135352C2273796E63223A
313337373636363335392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7546365576796145696657343B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A303220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A303220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
303120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393135352C2273796E63223A
313337373636363336322C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4965457551424D62306932343B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A303420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A303420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
303420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393136302C2273796E63223A
313337373636363336342C226D73223A327D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D66394A4C53515A306D664C423B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A303720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A303720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
303720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393137332C2273796E63223A
313337373636363336372C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D564D4F4B6E736D6F4F4576633B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A303920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A303920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
303920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393137332C2273796E63223A
313337373636363336392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6B6558517A6D414366304F7A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A313120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A313120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
313120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393137332C2273796E63223A
313337373636363337312C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4272687673364D76723053443B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A313420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A313420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
313420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393137362C2273796E63223A
313337373636363337342C226D73223A327D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D47706D7771545072376B7A463B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A313620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A313620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
313620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393138302C2273796E63223A
313337373636363337362C226D73223A327D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4E6C746D59765358557539423B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A313920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A313920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
313920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393138312C2273796E63223A
313337373636363337392C226D73223A327D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7A37325574756C376F4532643B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A323120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A323120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
323120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393138322C2273796E63223A
313337373636363338312C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D326E6D7A305A4A4F55614B703B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A323320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A323320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
323320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393138322C2273796E63223A
313337373636363338332C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D633638705737656A476B57673B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A323620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A323620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
323620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393138342C2273796E63223A
313337373636363338362C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D47326E6A4536794E574536533B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A323820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A323820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
323820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313237390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343534392C22636F6E74656E74223A2269742070757473206C6F677320
696E202F757365722F617070646174612F726F616D696E672F64726D656D6F72
79222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363333332C226D6573736167655F6564697473223A31
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636343634322C22636F6E74656E74223A226F6B2C20676F696E67
20746F2074727920636F6D6D616E64206C696E6520736F207265626F6F74696E
67222C22757365725F6964223A37363835322C22757365725F6E616D65223A22
47726168616D2043686975222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363334357D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636353632342C22636F6E
74656E74223A224047726168616D436869752069732074686973206120636C6F
73656420736F75726365207363726970743F206973206974206F6B2069662049
20646F20736F6D652076657273696F6E20636F6E74726F6C206F66206D792074
657374696E673F222C22757365725F6964223A323536323731312C2275736572
5F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363532312C22706172656E745F696422
3A31313437363334357D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636353938342C22636F6E74656E74223A22
406B65616C697374204E6F2C2069745C75303032362333393B732074616B656E
2066726F6D206D7920676974687562207265706F2066726F6D2061206C617267
657220736372697074222C22757365725F6964223A37363835322C2275736572
5F6E616D65223A2247726168616D2043686975222C22726F6F6D5F6964223A32
39312C226D6573736167655F6964223A31313437363539362C22706172656E74
5F6964223A31313437363532312C2273686F775F706172656E74223A74727565
7D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374616D7022
3A313337373636363230332C22636F6E74656E74223A22476F74206120737973
74656D206572726F7220233134303520746869732074696D65222C2275736572
5F6964223A37363835322C22757365725F6E616D65223A2247726168616D2043
686975222C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A
31313437363634397D2C0D0A7B226576656E745F74797065223A312C2274696D
655F7374616D70223A313337373636363330342C22636F6E74656E74223A2248
656C7020636F6D707574657221222C226964223A32323830393133302C227573
65725F6964223A323536323731312C22757365725F6E616D65223A226B65616C
697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A22
5B5265626F6C20616E64205265645D222C226D6573736167655F6964223A3131
3437363638337D5D2C2274696D65223A32323830393138342C2273796E63223A
313337373636363338382C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5135766B6C685775457934503B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A333120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A333120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
333120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313033390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D5D2C2274696D65223A
32323830393138342C2273796E63223A313337373636363339312C226D73223A
327D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D783068454F733257686B69433B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A333320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A333320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
333320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313033390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D5D2C2274696D65223A
32323830393138342C2273796E63223A313337373636363339332C226D73223A
307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4E767A446D4D5148454B35303B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A333520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A333520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
333520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313033390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D5D2C2274696D65223A
32323830393138362C2273796E63223A313337373636363339352C226D73223A
327D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6E6542595244396A716B796B3B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A333820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A333820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
333820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313033390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D5D2C2274696D65223A
32323830393138372C2273796E63223A313337373636363339382C226D73223A
317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D615662495448626345474C4E3B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A343020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A343020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
343020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313033390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D5D2C2274696D65223A
32323830393138372C2273796E63223A313337373636363430302C226D73223A
317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6B5068564B32656E5145714B3B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A343320474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A343320474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
343320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313033390D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D5D2C2274696D65223A
32323830393138392C2273796E63223A313337373636363430332C226D73223A
317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D71495A71744C6536366B795A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A343520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A343520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
343520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393139342C2273796E63223A313337
373636363430352C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D44685057626A6C51546B37423B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A343820474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A343820474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
343720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393139342C2273796E63223A313337
373636363430382C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D65373378395A5A36446B6C583B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A353020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A353020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
353020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393139352C2273796E63223A313337
373636363431302C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D41354D33307A3655575561443B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A353220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A353220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
353220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393139392C2273796E63223A313337
373636363431322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D757A5130794A5836476B57663B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A353520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A353520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
353520474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393230312C2273796E63223A313337
373636363431352C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D773757557A4C4253455547413B20657870697265733D
4672692C2032382D4665622D323031342030353A30363A353720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30363A353720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30363A
353720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393230312C2273796E63223A313337
373636363431372C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7059476C307634424D304B4F3B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A303020474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A303020474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
303020474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393230332C2273796E63223A313337
373636363432302C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4152624247363256316B616C3B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A303220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A303220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
303220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393230352C2273796E63223A313337
373636363432322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4E4C31514A394D326F4557493B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A303520474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A303520474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
303420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393230352C2273796E63223A313337
373636363432352C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6B334964546B41304D6B39773B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A303720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A303720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
303720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393230362C2273796E63223A313337
373636363432372C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D756B326E765A586D4A454F643B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A303920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A303920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
303920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393230362C2273796E63223A313337
373636363432392C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D5846526E794C71586345717A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A313220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A313220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
313220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393231302C2273796E63223A313337
373636363433322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D58424E6264475750554762533B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A313420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A313420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
313420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393231322C2273796E63223A313337
373636363433342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6E30776B6447624545324B463B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A313720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A313720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
313720474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393231322C2273796E63223A313337
373636363433372C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D75357A6456333255316B43363B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A313920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A313920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
313920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393231322C2273796E63223A313337
373636363433392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6B77424E6B355564456D45713B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A323220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A323220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
323220474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393231352C2273796E63223A313337
373636363434322C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6265785768756C39355575723B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A323420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A323420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
323420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393231362C2273796E63223A313337
373636363434342C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7169726C4A5543504B5565413B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A323720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A323720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
323620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393232312C2273796E63223A313337
373636363434372C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D71626F7739343242656B4F793B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A323920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A323920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
323920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393232312C2273796E63223A313337
373636363434392C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4D7A436F34433965426B43693B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A333120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A333120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
333120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393232332C2273796E63223A313337
373636363435312C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4A62316C74564E4E666B69363B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A333420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A333420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
333420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393232332C2273796E63223A313337
373636363435342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4C474D38416A41315A454F693B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A333620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A333620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
333620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393232362C2273796E63223A313337
373636363435362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4235454647676D4A646B69303B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A333920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A333920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
333920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393232362C2273796E63223A313337
373636363435392C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D644E694178566361303037673B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A343120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A343120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
343120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393232362C2273796E63223A313337
373636363436312C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D74346F356D6F4149703079683B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A343420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A343420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
343320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393232362C2273796E63223A313337
373636363436342C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D39635A6176346C4A4E3047743B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A343620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A343620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
343620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393232362C2273796E63223A313337
373636363436362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4F326E43367874316B7578653B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A343920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A343920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
343820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393232362C2273796E63223A313337
373636363436392C226D73223A337D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3278414956367943424565793B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A353120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A353120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
353120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393232362C2273796E63223A313337
373636363437312C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D567251614F655A456D6B716C3B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A353620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A353620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
353620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393232392C2273796E63223A313337
373636363437362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D44754E344630746C44304B6E3B20657870697265733D
4672692C2032382D4665622D323031342030353A30373A353920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30373A353920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30373A
353920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393233302C2273796E63223A313337
373636363437392C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D664178746854743030754B643B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A303120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A303120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
303120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393233312C2273796E63223A313337
373636363438312C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6667327A45356A50614571473B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A303420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A303420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
303320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393233322C2273796E63223A313337
373636363438342C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6A436B44614C6E63454878423B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A303620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A303620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
303620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393233322C2273796E63223A313337
373636363438362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D764B6E615A3156464F5532383B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A303920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A303920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
303820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393233332C2273796E63223A313337
373636363438392C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D416777623943626A34456D723B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A313120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A313120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
313120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393233342C2273796E63223A313337
373636363439312C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D7630654C6577706F416B32693B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A313720474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A313720474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
313620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323236380D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D5D2C2274696D65223A32323830393233352C2273796E63223A313337
373636363439372C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D37546C71555A6A795A6B79383B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A313920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A313920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
313920474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323538310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C226964223A32323830393233362C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A
225B5265626F6C20616E64205265645D222C226D6573736167655F6964223A31
313437363733352C22706172656E745F6964223A31313437363731317D5D2C22
74696D65223A32323830393233372C2273796E63223A31333737363636343939
2C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4D38745465717635735553353B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A323120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A323120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
323120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323833310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C226964223A32323830393233362C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A
225B5265626F6C20616E64205265645D222C226D6573736167655F6964223A31
313437363733352C22706172656E745F6964223A31313437363731317D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363530302C22636F6E74656E74223A22406B65616C6973742061646465
64206B65793A2068656C7020636F6D7075746572222C226964223A3232383039
3233382C22757365725F6964223A323130393838332C22757365725F6E616D65
223A225265626F6C426F74222C22726F6F6D5F6964223A3239312C22726F6F6D
5F6E616D65223A225B5265626F6C20616E64205265645D222C226D6573736167
655F6964223A31313437363733362C22706172656E745F6964223A3131343736
3733352C2273686F775F706172656E74223A747275657D5D2C2274696D65223A
32323830393233392C2273796E63223A313337373636363530312C226D73223A
307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D63487337794D37784655477A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A323420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A323420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
323320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323833310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C226964223A32323830393233362C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A
225B5265626F6C20616E64205265645D222C226D6573736167655F6964223A31
313437363733352C22706172656E745F6964223A31313437363731317D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363530302C22636F6E74656E74223A22406B65616C6973742061646465
64206B65793A2068656C7020636F6D7075746572222C226964223A3232383039
3233382C22757365725F6964223A323130393838332C22757365725F6E616D65
223A225265626F6C426F74222C22726F6F6D5F6964223A3239312C22726F6F6D
5F6E616D65223A225B5265626F6C20616E64205265645D222C226D6573736167
655F6964223A31313437363733362C22706172656E745F6964223A3131343736
3733352C2273686F775F706172656E74223A747275657D5D2C2274696D65223A
32323830393234302C2273796E63223A313337373636363530342C226D73223A
327D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D654632566B43797370554F633B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A323620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A323620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
323620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323833310D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C226964223A32323830393233362C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A
225B5265626F6C20616E64205265645D222C226D6573736167655F6964223A31
313437363733352C22706172656E745F6964223A31313437363731317D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363530302C22636F6E74656E74223A22406B65616C6973742061646465
64206B65793A2068656C7020636F6D7075746572222C226964223A3232383039
3233382C22757365725F6964223A323130393838332C22757365725F6E616D65
223A225265626F6C426F74222C22726F6F6D5F6964223A3239312C22726F6F6D
5F6E616D65223A225B5265626F6C20616E64205265645D222C226D6573736167
655F6964223A31313437363733362C22706172656E745F6964223A3131343736
3733352C2273686F775F706172656E74223A747275657D5D2C2274696D65223A
32323830393234312C2273796E63223A313337373636363530362C226D73223A
307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D624A45426D687976304B73773B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A323920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A323920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
323820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20323833320D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636343634322C22636F6E74656E74223A226F6B2C20676F696E6720746F20
74727920636F6D6D616E64206C696E6520736F207265626F6F74696E67222C22
757365725F6964223A37363835322C22757365725F6E616D65223A2247726168
616D2043686975222C22726F6F6D5F6964223A3239312C226D6573736167655F
6964223A31313437363334357D2C0D0A7B226576656E745F74797065223A312C
2274696D655F7374616D70223A313337373636353632342C22636F6E74656E74
223A224047726168616D436869752069732074686973206120636C6F73656420
736F75726365207363726970743F206973206974206F6B206966204920646F20
736F6D652076657273696F6E20636F6E74726F6C206F66206D79207465737469
6E673F222C22757365725F6964223A323536323731312C22757365725F6E616D
65223A226B65616C697374222C22726F6F6D5F6964223A3239312C226D657373
6167655F6964223A31313437363532312C22706172656E745F6964223A313134
37363334357D2C0D0A7B226576656E745F74797065223A312C2274696D655F73
74616D70223A313337373636353938342C22636F6E74656E74223A22406B6561
6C697374204E6F2C2069745C75303032362333393B732074616B656E2066726F
6D206D7920676974687562207265706F2066726F6D2061206C61726765722073
6372697074222C22757365725F6964223A37363835322C22757365725F6E616D
65223A2247726168616D2043686975222C22726F6F6D5F6964223A3239312C22
6D6573736167655F6964223A31313437363539362C22706172656E745F696422
3A31313437363532312C2273686F775F706172656E74223A747275657D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363230332C22636F6E74656E74223A22476F7420612073797374656D20
6572726F7220233134303520746869732074696D65222C22757365725F696422
3A37363835322C22757365725F6E616D65223A2247726168616D204368697522
2C22726F6F6D5F6964223A3239312C226D6573736167655F6964223A31313437
363634397D2C0D0A7B226576656E745F74797065223A312C2274696D655F7374
616D70223A313337373636363330342C22636F6E74656E74223A2248656C7020
636F6D707574657221222C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363638337D2C0D0A7B226576656E
745F74797065223A312C2274696D655F7374616D70223A313337373636363430
332C22636F6E74656E74223A22405265626F6C426F742068656C70222C226964
223A32323830393139302C22757365725F6964223A323536323731312C227573
65725F6E616D65223A226B65616C697374222C22726F6F6D5F6964223A323931
2C22726F6F6D5F6E616D65223A225B5265626F6C20616E64205265645D222C22
6D6573736167655F6964223A31313437363730392C22706172656E745F696422
3A31313436363133377D2C0D0A7B226576656E745F74797065223A312C227469
6D655F7374616D70223A313337373636363430352C22636F6E74656E74223A22
5C753030336364697620636C6173733D5C75303032377061727469616C5C7530
3032375C75303033654920726573706F6E6420746F20746865736520636F6D6D
616E6473205C753030336362725C7530303365204E6F74653A205B5D206D6561
6E73206F7074696F6E616C20696E707574206F722073686F7773206578706563
7465642064617461747970652C20287C29206D65616E732063686F6963653A20
5C753030336362725C75303033652028646F7C646F2F327C646F2F7265647C64
6F2F626F726F6E292065787072657373696F6E205C753030323671756F743B65
76616C7561746573205265626F6C2F5265626F6C2D6C696B6520657870726573
73696F6E20696E20612073616E64626F78656420696E7465727072657465725C
753030323671756F743B205C753030336362725C7530303365202868697C6865
6C6C6F7C676F6F646E696768747C676F6F646279657C6279657C5B676F6F645D
5B6E696768747C6D6F726E696E677C61667465726E6F6F6E7C6576656E696E67
5D2920736F6D652D74657874205C753030323671756F743B72657475726E7320
61206772656574696E6720746F2074686520757365722077686F206772656574
656420626F745C753030323671756F743B205C753030336362725C7530303365
206363206964205C753030323671756F743B7265747269657665732063757265
636F646520646174615C753030323671756F743B205C753030336362725C7530
3033652064656C657465205B206C6F7564205D205C753030323671756F743B69
6E207265706C7920746F206120626F74206D6573736167652077696C6C206465
6C65746520696620696E2074696D655C753030323671756F743B205C75303033
6362725C753030336520646F2F6964656F6E652077686963682D6C616E67205B
776F72642120737472696E672120696E7465676572215D206578707265737369
6F6E205C753030323671756F743B6576616C7561746573206120736F75726365
2065787072657373696F6E20666F722074686520737065636966696564206C61
6E67756167655C753030323671756F743B5C75303033632F6469765C75303033
65222C226964223A32323830393139332C22757365725F6964223A3231303938
38332C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F
6964223A3239312C22726F6F6D5F6E616D65223A225B5265626F6C20616E6420
5265645D222C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C226964223A32323830393233362C2275
7365725F6964223A323536323731312C22757365725F6E616D65223A226B6561
6C697374222C22726F6F6D5F6964223A3239312C22726F6F6D5F6E616D65223A
225B5265626F6C20616E64205265645D222C226D6573736167655F6964223A31
313437363733352C22706172656E745F6964223A31313437363731317D2C0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363530302C22636F6E74656E74223A22406B65616C6973742061646465
64206B65793A2068656C7020636F6D7075746572222C226964223A3232383039
3233382C22757365725F6964223A323130393838332C22757365725F6E616D65
223A225265626F6C426F74222C22726F6F6D5F6964223A3239312C22726F6F6D
5F6E616D65223A225B5265626F6C20616E64205265645D222C226D6573736167
655F6964223A31313437363733362C22706172656E745F6964223A3131343736
3733352C2273686F775F706172656E74223A747275657D5D2C2274696D65223A
32323830393234332C2273796E63223A313337373636363530392C226D73223A
31317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6F69757766706954586B53703B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A333120474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A333120474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
333120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313831350D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363330342C22636F6E74656E74223A2248656C7020636F6D7075746572
21222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363638337D2C0D0A7B226576656E745F74797065223A
312C2274696D655F7374616D70223A313337373636363430332C22636F6E7465
6E74223A22405265626F6C426F742068656C70222C22757365725F6964223A32
3536323731312C22757365725F6E616D65223A226B65616C697374222C22726F
6F6D5F6964223A3239312C226D6573736167655F6964223A3131343736373039
2C22706172656E745F6964223A31313436363133377D2C0D0A7B226576656E74
5F74797065223A312C2274696D655F7374616D70223A31333737363636343035
2C22636F6E74656E74223A225C753030336364697620636C6173733D5C753030
32377061727469616C5C75303032375C75303033654920726573706F6E642074
6F20746865736520636F6D6D616E6473205C753030336362725C753030336520
4E6F74653A205B5D206D65616E73206F7074696F6E616C20696E707574206F72
2073686F77732065787065637465642064617461747970652C20287C29206D65
616E732063686F6963653A205C753030336362725C75303033652028646F7C64
6F2F327C646F2F7265647C646F2F626F726F6E292065787072657373696F6E20
5C753030323671756F743B6576616C7561746573205265626F6C2F5265626F6C
2D6C696B652065787072657373696F6E20696E20612073616E64626F78656420
696E7465727072657465725C753030323671756F743B205C753030336362725C
7530303365202868697C68656C6C6F7C676F6F646E696768747C676F6F646279
657C6279657C5B676F6F645D5B6E696768747C6D6F726E696E677C6166746572
6E6F6F6E7C6576656E696E675D2920736F6D652D74657874205C753030323671
756F743B72657475726E732061206772656574696E6720746F20746865207573
65722077686F206772656574656420626F745C753030323671756F743B205C75
3030336362725C7530303365206363206964205C753030323671756F743B7265
747269657665732063757265636F646520646174615C753030323671756F743B
205C753030336362725C75303033652064656C657465205B206C6F7564205D20
5C753030323671756F743B696E207265706C7920746F206120626F74206D6573
736167652077696C6C2064656C65746520696620696E2074696D655C75303032
3671756F743B205C753030336362725C753030336520646F2F6964656F6E6520
77686963682D6C616E67205B776F72642120737472696E672120696E74656765
72215D2065787072657373696F6E205C753030323671756F743B6576616C7561
746573206120736F757263652065787072657373696F6E20666F722074686520
737065636966696564206C616E67756167655C753030323671756F743B5C7530
3033632F6469765C7530303365222C22757365725F6964223A32313039383833
2C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C22757365725F6964223A323536323731
312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363733352C22706172
656E745F6964223A31313437363731317D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636363530302C22636F6E
74656E74223A22406B65616C697374206164646564206B65793A2068656C7020
636F6D7075746572222C22757365725F6964223A323130393838332C22757365
725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363733362C22706172656E745F69
64223A31313437363733352C2273686F775F706172656E74223A747275657D5D
2C2274696D65223A32323830393234342C2273796E63223A3133373736363635
31312C226D73223A327D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4C616237475A6276773071333B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A333420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A333420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
333320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313831350D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363330342C22636F6E74656E74223A2248656C7020636F6D7075746572
21222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363638337D2C0D0A7B226576656E745F74797065223A
312C2274696D655F7374616D70223A313337373636363430332C22636F6E7465
6E74223A22405265626F6C426F742068656C70222C22757365725F6964223A32
3536323731312C22757365725F6E616D65223A226B65616C697374222C22726F
6F6D5F6964223A3239312C226D6573736167655F6964223A3131343736373039
2C22706172656E745F6964223A31313436363133377D2C0D0A7B226576656E74
5F74797065223A312C2274696D655F7374616D70223A31333737363636343035
2C22636F6E74656E74223A225C753030336364697620636C6173733D5C753030
32377061727469616C5C75303032375C75303033654920726573706F6E642074
6F20746865736520636F6D6D616E6473205C753030336362725C753030336520
4E6F74653A205B5D206D65616E73206F7074696F6E616C20696E707574206F72
2073686F77732065787065637465642064617461747970652C20287C29206D65
616E732063686F6963653A205C753030336362725C75303033652028646F7C64
6F2F327C646F2F7265647C646F2F626F726F6E292065787072657373696F6E20
5C753030323671756F743B6576616C7561746573205265626F6C2F5265626F6C
2D6C696B652065787072657373696F6E20696E20612073616E64626F78656420
696E7465727072657465725C753030323671756F743B205C753030336362725C
7530303365202868697C68656C6C6F7C676F6F646E696768747C676F6F646279
657C6279657C5B676F6F645D5B6E696768747C6D6F726E696E677C6166746572
6E6F6F6E7C6576656E696E675D2920736F6D652D74657874205C753030323671
756F743B72657475726E732061206772656574696E6720746F20746865207573
65722077686F206772656574656420626F745C753030323671756F743B205C75
3030336362725C7530303365206363206964205C753030323671756F743B7265
747269657665732063757265636F646520646174615C753030323671756F743B
205C753030336362725C75303033652064656C657465205B206C6F7564205D20
5C753030323671756F743B696E207265706C7920746F206120626F74206D6573
736167652077696C6C2064656C65746520696620696E2074696D655C75303032
3671756F743B205C753030336362725C753030336520646F2F6964656F6E6520
77686963682D6C616E67205B776F72642120737472696E672120696E74656765
72215D2065787072657373696F6E205C753030323671756F743B6576616C7561
746573206120736F757263652065787072657373696F6E20666F722074686520
737065636966696564206C616E67756167655C753030323671756F743B5C7530
3033632F6469765C7530303365222C22757365725F6964223A32313039383833
2C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C22757365725F6964223A323536323731
312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363733352C22706172
656E745F6964223A31313437363731317D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636363530302C22636F6E
74656E74223A22406B65616C697374206164646564206B65793A2068656C7020
636F6D7075746572222C22757365725F6964223A323130393838332C22757365
725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363733362C22706172656E745F69
64223A31313437363733352C2273686F775F706172656E74223A747275657D5D
2C2274696D65223A32323830393234372C2273796E63223A3133373736363635
31342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D703879736C4F4732786B32593B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A333620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A333620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
333620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313831350D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363330342C22636F6E74656E74223A2248656C7020636F6D7075746572
21222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363638337D2C0D0A7B226576656E745F74797065223A
312C2274696D655F7374616D70223A313337373636363430332C22636F6E7465
6E74223A22405265626F6C426F742068656C70222C22757365725F6964223A32
3536323731312C22757365725F6E616D65223A226B65616C697374222C22726F
6F6D5F6964223A3239312C226D6573736167655F6964223A3131343736373039
2C22706172656E745F6964223A31313436363133377D2C0D0A7B226576656E74
5F74797065223A312C2274696D655F7374616D70223A31333737363636343035
2C22636F6E74656E74223A225C753030336364697620636C6173733D5C753030
32377061727469616C5C75303032375C75303033654920726573706F6E642074
6F20746865736520636F6D6D616E6473205C753030336362725C753030336520
4E6F74653A205B5D206D65616E73206F7074696F6E616C20696E707574206F72
2073686F77732065787065637465642064617461747970652C20287C29206D65
616E732063686F6963653A205C753030336362725C75303033652028646F7C64
6F2F327C646F2F7265647C646F2F626F726F6E292065787072657373696F6E20
5C753030323671756F743B6576616C7561746573205265626F6C2F5265626F6C
2D6C696B652065787072657373696F6E20696E20612073616E64626F78656420
696E7465727072657465725C753030323671756F743B205C753030336362725C
7530303365202868697C68656C6C6F7C676F6F646E696768747C676F6F646279
657C6279657C5B676F6F645D5B6E696768747C6D6F726E696E677C6166746572
6E6F6F6E7C6576656E696E675D2920736F6D652D74657874205C753030323671
756F743B72657475726E732061206772656574696E6720746F20746865207573
65722077686F206772656574656420626F745C753030323671756F743B205C75
3030336362725C7530303365206363206964205C753030323671756F743B7265
747269657665732063757265636F646520646174615C753030323671756F743B
205C753030336362725C75303033652064656C657465205B206C6F7564205D20
5C753030323671756F743B696E207265706C7920746F206120626F74206D6573
736167652077696C6C2064656C65746520696620696E2074696D655C75303032
3671756F743B205C753030336362725C753030336520646F2F6964656F6E6520
77686963682D6C616E67205B776F72642120737472696E672120696E74656765
72215D2065787072657373696F6E205C753030323671756F743B6576616C7561
746573206120736F757263652065787072657373696F6E20666F722074686520
737065636966696564206C616E67756167655C753030323671756F743B5C7530
3033632F6469765C7530303365222C22757365725F6964223A32313039383833
2C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C22757365725F6964223A323536323731
312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363733352C22706172
656E745F6964223A31313437363731317D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636363530302C22636F6E
74656E74223A22406B65616C697374206164646564206B65793A2068656C7020
636F6D7075746572222C22757365725F6964223A323130393838332C22757365
725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363733362C22706172656E745F69
64223A31313437363733352C2273686F775F706172656E74223A747275657D5D
2C2274696D65223A32323830393235312C2273796E63223A3133373736363635
31362C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D4757666143504A37326B75663B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A343220474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A343220474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
343120474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313831350D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363330342C22636F6E74656E74223A2248656C7020636F6D7075746572
21222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363638337D2C0D0A7B226576656E745F74797065223A
312C2274696D655F7374616D70223A313337373636363430332C22636F6E7465
6E74223A22405265626F6C426F742068656C70222C22757365725F6964223A32
3536323731312C22757365725F6E616D65223A226B65616C697374222C22726F
6F6D5F6964223A3239312C226D6573736167655F6964223A3131343736373039
2C22706172656E745F6964223A31313436363133377D2C0D0A7B226576656E74
5F74797065223A312C2274696D655F7374616D70223A31333737363636343035
2C22636F6E74656E74223A225C753030336364697620636C6173733D5C753030
32377061727469616C5C75303032375C75303033654920726573706F6E642074
6F20746865736520636F6D6D616E6473205C753030336362725C753030336520
4E6F74653A205B5D206D65616E73206F7074696F6E616C20696E707574206F72
2073686F77732065787065637465642064617461747970652C20287C29206D65
616E732063686F6963653A205C753030336362725C75303033652028646F7C64
6F2F327C646F2F7265647C646F2F626F726F6E292065787072657373696F6E20
5C753030323671756F743B6576616C7561746573205265626F6C2F5265626F6C
2D6C696B652065787072657373696F6E20696E20612073616E64626F78656420
696E7465727072657465725C753030323671756F743B205C753030336362725C
7530303365202868697C68656C6C6F7C676F6F646E696768747C676F6F646279
657C6279657C5B676F6F645D5B6E696768747C6D6F726E696E677C6166746572
6E6F6F6E7C6576656E696E675D2920736F6D652D74657874205C753030323671
756F743B72657475726E732061206772656574696E6720746F20746865207573
65722077686F206772656574656420626F745C753030323671756F743B205C75
3030336362725C7530303365206363206964205C753030323671756F743B7265
747269657665732063757265636F646520646174615C753030323671756F743B
205C753030336362725C75303033652064656C657465205B206C6F7564205D20
5C753030323671756F743B696E207265706C7920746F206120626F74206D6573
736167652077696C6C2064656C65746520696620696E2074696D655C75303032
3671756F743B205C753030336362725C753030336520646F2F6964656F6E6520
77686963682D6C616E67205B776F72642120737472696E672120696E74656765
72215D2065787072657373696F6E205C753030323671756F743B6576616C7561
746573206120736F757263652065787072657373696F6E20666F722074686520
737065636966696564206C616E67756167655C753030323671756F743B5C7530
3033632F6469765C7530303365222C22757365725F6964223A32313039383833
2C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C22757365725F6964223A323536323731
312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363733352C22706172
656E745F6964223A31313437363731317D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636363530302C22636F6E
74656E74223A22406B65616C697374206164646564206B65793A2068656C7020
636F6D7075746572222C22757365725F6964223A323130393838332C22757365
725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363733362C22706172656E745F69
64223A31313437363733352C2273686F775F706172656E74223A747275657D5D
2C2274696D65223A32323830393235332C2273796E63223A3133373736363635
32322C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D66344B3773646C7A73306D5A3B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A343420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A343420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
343420474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313831350D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363330342C22636F6E74656E74223A2248656C7020636F6D7075746572
21222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363638337D2C0D0A7B226576656E745F74797065223A
312C2274696D655F7374616D70223A313337373636363430332C22636F6E7465
6E74223A22405265626F6C426F742068656C70222C22757365725F6964223A32
3536323731312C22757365725F6E616D65223A226B65616C697374222C22726F
6F6D5F6964223A3239312C226D6573736167655F6964223A3131343736373039
2C22706172656E745F6964223A31313436363133377D2C0D0A7B226576656E74
5F74797065223A312C2274696D655F7374616D70223A31333737363636343035
2C22636F6E74656E74223A225C753030336364697620636C6173733D5C753030
32377061727469616C5C75303032375C75303033654920726573706F6E642074
6F20746865736520636F6D6D616E6473205C753030336362725C753030336520
4E6F74653A205B5D206D65616E73206F7074696F6E616C20696E707574206F72
2073686F77732065787065637465642064617461747970652C20287C29206D65
616E732063686F6963653A205C753030336362725C75303033652028646F7C64
6F2F327C646F2F7265647C646F2F626F726F6E292065787072657373696F6E20
5C753030323671756F743B6576616C7561746573205265626F6C2F5265626F6C
2D6C696B652065787072657373696F6E20696E20612073616E64626F78656420
696E7465727072657465725C753030323671756F743B205C753030336362725C
7530303365202868697C68656C6C6F7C676F6F646E696768747C676F6F646279
657C6279657C5B676F6F645D5B6E696768747C6D6F726E696E677C6166746572
6E6F6F6E7C6576656E696E675D2920736F6D652D74657874205C753030323671
756F743B72657475726E732061206772656574696E6720746F20746865207573
65722077686F206772656574656420626F745C753030323671756F743B205C75
3030336362725C7530303365206363206964205C753030323671756F743B7265
747269657665732063757265636F646520646174615C753030323671756F743B
205C753030336362725C75303033652064656C657465205B206C6F7564205D20
5C753030323671756F743B696E207265706C7920746F206120626F74206D6573
736167652077696C6C2064656C65746520696620696E2074696D655C75303032
3671756F743B205C753030336362725C753030336520646F2F6964656F6E6520
77686963682D6C616E67205B776F72642120737472696E672120696E74656765
72215D2065787072657373696F6E205C753030323671756F743B6576616C7561
746573206120736F757263652065787072657373696F6E20666F722074686520
737065636966696564206C616E67756167655C753030323671756F743B5C7530
3033632F6469765C7530303365222C22757365725F6964223A32313039383833
2C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C22757365725F6964223A323536323731
312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363733352C22706172
656E745F6964223A31313437363731317D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636363530302C22636F6E
74656E74223A22406B65616C697374206164646564206B65793A2068656C7020
636F6D7075746572222C22757365725F6964223A323130393838332C22757365
725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363733362C22706172656E745F69
64223A31313437363733352C2273686F775F706172656E74223A747275657D5D
2C2274696D65223A32323830393235332C2273796E63223A3133373736363635
32342C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D434B663241696847783047753B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A343620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A343620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
343620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313831350D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363330342C22636F6E74656E74223A2248656C7020636F6D7075746572
21222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363638337D2C0D0A7B226576656E745F74797065223A
312C2274696D655F7374616D70223A313337373636363430332C22636F6E7465
6E74223A22405265626F6C426F742068656C70222C22757365725F6964223A32
3536323731312C22757365725F6E616D65223A226B65616C697374222C22726F
6F6D5F6964223A3239312C226D6573736167655F6964223A3131343736373039
2C22706172656E745F6964223A31313436363133377D2C0D0A7B226576656E74
5F74797065223A312C2274696D655F7374616D70223A31333737363636343035
2C22636F6E74656E74223A225C753030336364697620636C6173733D5C753030
32377061727469616C5C75303032375C75303033654920726573706F6E642074
6F20746865736520636F6D6D616E6473205C753030336362725C753030336520
4E6F74653A205B5D206D65616E73206F7074696F6E616C20696E707574206F72
2073686F77732065787065637465642064617461747970652C20287C29206D65
616E732063686F6963653A205C753030336362725C75303033652028646F7C64
6F2F327C646F2F7265647C646F2F626F726F6E292065787072657373696F6E20
5C753030323671756F743B6576616C7561746573205265626F6C2F5265626F6C
2D6C696B652065787072657373696F6E20696E20612073616E64626F78656420
696E7465727072657465725C753030323671756F743B205C753030336362725C
7530303365202868697C68656C6C6F7C676F6F646E696768747C676F6F646279
657C6279657C5B676F6F645D5B6E696768747C6D6F726E696E677C6166746572
6E6F6F6E7C6576656E696E675D2920736F6D652D74657874205C753030323671
756F743B72657475726E732061206772656574696E6720746F20746865207573
65722077686F206772656574656420626F745C753030323671756F743B205C75
3030336362725C7530303365206363206964205C753030323671756F743B7265
747269657665732063757265636F646520646174615C753030323671756F743B
205C753030336362725C75303033652064656C657465205B206C6F7564205D20
5C753030323671756F743B696E207265706C7920746F206120626F74206D6573
736167652077696C6C2064656C65746520696620696E2074696D655C75303032
3671756F743B205C753030336362725C753030336520646F2F6964656F6E6520
77686963682D6C616E67205B776F72642120737472696E672120696E74656765
72215D2065787072657373696F6E205C753030323671756F743B6576616C7561
746573206120736F757263652065787072657373696F6E20666F722074686520
737065636966696564206C616E67756167655C753030323671756F743B5C7530
3033632F6469765C7530303365222C22757365725F6964223A32313039383833
2C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C22757365725F6964223A323536323731
312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363733352C22706172
656E745F6964223A31313437363731317D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636363530302C22636F6E
74656E74223A22406B65616C697374206164646564206B65793A2068656C7020
636F6D7075746572222C22757365725F6964223A323130393838332C22757365
725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363733362C22706172656E745F69
64223A31313437363733352C2273686F775F706172656E74223A747275657D5D
2C2274696D65223A32323830393235372C2273796E63223A3133373736363635
32362C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D61574D37344D4E3030496D383B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A343920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A343920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
343820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313831350D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363330342C22636F6E74656E74223A2248656C7020636F6D7075746572
21222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363638337D2C0D0A7B226576656E745F74797065223A
312C2274696D655F7374616D70223A313337373636363430332C22636F6E7465
6E74223A22405265626F6C426F742068656C70222C22757365725F6964223A32
3536323731312C22757365725F6E616D65223A226B65616C697374222C22726F
6F6D5F6964223A3239312C226D6573736167655F6964223A3131343736373039
2C22706172656E745F6964223A31313436363133377D2C0D0A7B226576656E74
5F74797065223A312C2274696D655F7374616D70223A31333737363636343035
2C22636F6E74656E74223A225C753030336364697620636C6173733D5C753030
32377061727469616C5C75303032375C75303033654920726573706F6E642074
6F20746865736520636F6D6D616E6473205C753030336362725C753030336520
4E6F74653A205B5D206D65616E73206F7074696F6E616C20696E707574206F72
2073686F77732065787065637465642064617461747970652C20287C29206D65
616E732063686F6963653A205C753030336362725C75303033652028646F7C64
6F2F327C646F2F7265647C646F2F626F726F6E292065787072657373696F6E20
5C753030323671756F743B6576616C7561746573205265626F6C2F5265626F6C
2D6C696B652065787072657373696F6E20696E20612073616E64626F78656420
696E7465727072657465725C753030323671756F743B205C753030336362725C
7530303365202868697C68656C6C6F7C676F6F646E696768747C676F6F646279
657C6279657C5B676F6F645D5B6E696768747C6D6F726E696E677C6166746572
6E6F6F6E7C6576656E696E675D2920736F6D652D74657874205C753030323671
756F743B72657475726E732061206772656574696E6720746F20746865207573
65722077686F206772656574656420626F745C753030323671756F743B205C75
3030336362725C7530303365206363206964205C753030323671756F743B7265
747269657665732063757265636F646520646174615C753030323671756F743B
205C753030336362725C75303033652064656C657465205B206C6F7564205D20
5C753030323671756F743B696E207265706C7920746F206120626F74206D6573
736167652077696C6C2064656C65746520696620696E2074696D655C75303032
3671756F743B205C753030336362725C753030336520646F2F6964656F6E6520
77686963682D6C616E67205B776F72642120737472696E672120696E74656765
72215D2065787072657373696F6E205C753030323671756F743B6576616C7561
746573206120736F757263652065787072657373696F6E20666F722074686520
737065636966696564206C616E67756167655C753030323671756F743B5C7530
3033632F6469765C7530303365222C22757365725F6964223A32313039383833
2C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C22757365725F6964223A323536323731
312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363733352C22706172
656E745F6964223A31313437363731317D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636363530302C22636F6E
74656E74223A22406B65616C697374206164646564206B65793A2068656C7020
636F6D7075746572222C22757365725F6964223A323130393838332C22757365
725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363733362C22706172656E745F69
64223A31313437363733352C2273686F775F706172656E74223A747275657D5D
2C2274696D65223A32323830393236302C2273796E63223A3133373736363635
32392C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D3373494A41357A7930716D413B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A353420474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A353420474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
353320474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313831350D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363330342C22636F6E74656E74223A2248656C7020636F6D7075746572
21222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363638337D2C0D0A7B226576656E745F74797065223A
312C2274696D655F7374616D70223A313337373636363430332C22636F6E7465
6E74223A22405265626F6C426F742068656C70222C22757365725F6964223A32
3536323731312C22757365725F6E616D65223A226B65616C697374222C22726F
6F6D5F6964223A3239312C226D6573736167655F6964223A3131343736373039
2C22706172656E745F6964223A31313436363133377D2C0D0A7B226576656E74
5F74797065223A312C2274696D655F7374616D70223A31333737363636343035
2C22636F6E74656E74223A225C753030336364697620636C6173733D5C753030
32377061727469616C5C75303032375C75303033654920726573706F6E642074
6F20746865736520636F6D6D616E6473205C753030336362725C753030336520
4E6F74653A205B5D206D65616E73206F7074696F6E616C20696E707574206F72
2073686F77732065787065637465642064617461747970652C20287C29206D65
616E732063686F6963653A205C753030336362725C75303033652028646F7C64
6F2F327C646F2F7265647C646F2F626F726F6E292065787072657373696F6E20
5C753030323671756F743B6576616C7561746573205265626F6C2F5265626F6C
2D6C696B652065787072657373696F6E20696E20612073616E64626F78656420
696E7465727072657465725C753030323671756F743B205C753030336362725C
7530303365202868697C68656C6C6F7C676F6F646E696768747C676F6F646279
657C6279657C5B676F6F645D5B6E696768747C6D6F726E696E677C6166746572
6E6F6F6E7C6576656E696E675D2920736F6D652D74657874205C753030323671
756F743B72657475726E732061206772656574696E6720746F20746865207573
65722077686F206772656574656420626F745C753030323671756F743B205C75
3030336362725C7530303365206363206964205C753030323671756F743B7265
747269657665732063757265636F646520646174615C753030323671756F743B
205C753030336362725C75303033652064656C657465205B206C6F7564205D20
5C753030323671756F743B696E207265706C7920746F206120626F74206D6573
736167652077696C6C2064656C65746520696620696E2074696D655C75303032
3671756F743B205C753030336362725C753030336520646F2F6964656F6E6520
77686963682D6C616E67205B776F72642120737472696E672120696E74656765
72215D2065787072657373696F6E205C753030323671756F743B6576616C7561
746573206120736F757263652065787072657373696F6E20666F722074686520
737065636966696564206C616E67756167655C753030323671756F743B5C7530
3033632F6469765C7530303365222C22757365725F6964223A32313039383833
2C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C22757365725F6964223A323536323731
312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363733352C22706172
656E745F6964223A31313437363731317D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636363530302C22636F6E
74656E74223A22406B65616C697374206164646564206B65793A2068656C7020
636F6D7075746572222C22757365725F6964223A323130393838332C22757365
725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363733362C22706172656E745F69
64223A31313437363733352C2273686F775F706172656E74223A747275657D5D
2C2274696D65223A32323830393236302C2273796E63223A3133373736363635
33342C226D73223A317D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6275395775787957624565393B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A353620474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A353620474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
353620474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313831350D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363330342C22636F6E74656E74223A2248656C7020636F6D7075746572
21222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363638337D2C0D0A7B226576656E745F74797065223A
312C2274696D655F7374616D70223A313337373636363430332C22636F6E7465
6E74223A22405265626F6C426F742068656C70222C22757365725F6964223A32
3536323731312C22757365725F6E616D65223A226B65616C697374222C22726F
6F6D5F6964223A3239312C226D6573736167655F6964223A3131343736373039
2C22706172656E745F6964223A31313436363133377D2C0D0A7B226576656E74
5F74797065223A312C2274696D655F7374616D70223A31333737363636343035
2C22636F6E74656E74223A225C753030336364697620636C6173733D5C753030
32377061727469616C5C75303032375C75303033654920726573706F6E642074
6F20746865736520636F6D6D616E6473205C753030336362725C753030336520
4E6F74653A205B5D206D65616E73206F7074696F6E616C20696E707574206F72
2073686F77732065787065637465642064617461747970652C20287C29206D65
616E732063686F6963653A205C753030336362725C75303033652028646F7C64
6F2F327C646F2F7265647C646F2F626F726F6E292065787072657373696F6E20
5C753030323671756F743B6576616C7561746573205265626F6C2F5265626F6C
2D6C696B652065787072657373696F6E20696E20612073616E64626F78656420
696E7465727072657465725C753030323671756F743B205C753030336362725C
7530303365202868697C68656C6C6F7C676F6F646E696768747C676F6F646279
657C6279657C5B676F6F645D5B6E696768747C6D6F726E696E677C6166746572
6E6F6F6E7C6576656E696E675D2920736F6D652D74657874205C753030323671
756F743B72657475726E732061206772656574696E6720746F20746865207573
65722077686F206772656574656420626F745C753030323671756F743B205C75
3030336362725C7530303365206363206964205C753030323671756F743B7265
747269657665732063757265636F646520646174615C753030323671756F743B
205C753030336362725C75303033652064656C657465205B206C6F7564205D20
5C753030323671756F743B696E207265706C7920746F206120626F74206D6573
736167652077696C6C2064656C65746520696620696E2074696D655C75303032
3671756F743B205C753030336362725C753030336520646F2F6964656F6E6520
77686963682D6C616E67205B776F72642120737472696E672120696E74656765
72215D2065787072657373696F6E205C753030323671756F743B6576616C7561
746573206120736F757263652065787072657373696F6E20666F722074686520
737065636966696564206C616E67756167655C753030323671756F743B5C7530
3033632F6469765C7530303365222C22757365725F6964223A32313039383833
2C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C22757365725F6964223A323536323731
312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363733352C22706172
656E745F6964223A31313437363731317D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636363530302C22636F6E
74656E74223A22406B65616C697374206164646564206B65793A2068656C7020
636F6D7075746572222C22757365725F6964223A323130393838332C22757365
725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363733362C22706172656E745F69
64223A31313437363733352C2273686F775F706172656E74223A747275657D5D
2C2274696D65223A32323830393236312C2273796E63223A3133373736363635
33362C226D73223A307D
} spec: make object! [
    title: "TCP Networking"
    scheme: 'tcp
    ref: tcp://chat.stackoverflow.com:80
    path: none
    host: "chat.stackoverflow.com"
    port-id: 80
]
scheme: make object! [
    name: 'tcp
    title: "TCP Networking"
    spec: make object! [
        title: none
        scheme: none
        ref: none
        path: none
        host: none
        port-id: 80
    ]
    info: make object! [
        local-ip: none
        local-port: none
        remote-ip: none
        remote-port: none
    ]
    actor: make native! [[port!]]
    awake: make function! [[event][print ['TCP-event event/type] true]]
]
actor: make native! [[port!]]
awake: make function! [[event /local result messages content message-no message-id data json user-name message-rule parent-id person-id timestamp][
    timestamp:
    person-id:
    message-id:
    parent-id: 0
    user-name: make string! 20
    message-rule: [
        <event_type> quote 1 |
        <time_stamp> set timestamp integer! |
        <content> set content string! |
        <id> integer! |
        <user_id> set person-id integer! |
        <user_name> set user-name string! |
        <room_id> integer! |
        <room_name> string! |
        <message_id> set message-id integer! |
        <parent_id> set parent-id integer! |
        <show_parent> logic! |
        tag! skip |
        end
    ]
    switch/default event/type [
        lookup [open event/port false]
        connect [
            write event/port #{
504F5354202F63686174732F3239312F6576656E747320485454502F312E300A
486F73743A20636861742E737461636B6F766572666C6F772E636F6D0A557365
722D4167656E743A204D6F7A696C6C612F352E300A4163636570743A202A2F2A
0A4163636570742D4C616E67756167653A20656E2D55532C656E3B713D302E35
0A4163636570742D456E636F64696E673A20677A69702C206465666C6174650A
444E543A20310A436F6E74656E742D547970653A206170706C69636174696F6E
2F782D7777772D666F726D2D75726C656E636F6465643B20636861727365743D
5554462D380A582D5265717565737465642D576974683A20584D4C4874747052
6571756573740A526566657265723A20687474703A2F2F636861742E73746163
6B6F766572666C6F772E636F6D0A436F6E74656E742D4C656E6774683A203730
0A436F6F6B69653A206373723D743D4C494249424D58414445325A3B205F5F75
746D613D3134303032393535332E323033393430333434362E31333737343832
3833382E313337373438323833382E313337373438353535342E323B205F5F75
746D7A3D3134303032393535332E313337373438323833382E312E312E75746D
6373723D28646972656374297C75746D63636E3D28646972656374297C75746D
636D643D286E6F6E65293B205F5F7163613D50302D313136363636373939372D
313337373438323833373630323B207573723D743D6F554B7577774A376C5557
7426733D5446355031565953776B32490A0A73696E63653D30266D6F64653D4D
65737361676573266D7367436F756E743D3526666B65793D6234343563626435
376636663837363664376166383733396634336139306537
}
            event/port/locals: copy #{}
            false
        ]
        wrote [read event/port false]
        read [
            append event/port/locals event/port/data
            clear event/port/data
            read event/port
            false
        ]
        close done [
            if event/port/data [
                append event/port/locals event/port/data
            ]
            result: to string! event/port/locals
            if parse result [thru "^/^/" copy result to end] [
                if json: load-json/flat result [
                    messages: json/2
                    len: length? system/contexts/user/all-messages
                    print now
                    foreach msg messages [
                        content: none
                        user-name: none
                        message-id: 0
                        either parse msg [some message-rule] [
                            content: trim decode-xml content
                            ?? message-id
                            if all [
                                integer? message-id
                                not exists? join storage-dir message-id
                            ] [
                                write join storage-dir message-id mold msg
                            ]
                            if message-id > lastmessage-no [
                                set 'lastmessage-no message-id
                                repend/only system/contexts/user/all-messages [person-id message-id user-name content timestamp]
                            ]
                        ] [print ["failed parse" msg]]
                    ]
                ]
            ]
            true
        ]
    ] [true]
]]
state: #{}
data: #{}
locals: #{
485454502F312E3120323030204F4B0D0A43616368652D436F6E74726F6C3A20
6E6F2D63616368650D0A507261676D613A206E6F2D63616368650D0A436F6E74
656E742D547970653A206170706C69636174696F6E2F6A736F6E3B2063686172
7365743D7574662D380D0A457870697265733A202D310D0A5365742D436F6F6B
69653A206373723D743D6F50443150495955454B76503B20657870697265733D
4672692C2032382D4665622D323031342030353A30383A353920474D543B2070
6174683D2F3B20487474704F6E6C790D0A5365742D436F6F6B69653A202E4153
505842726F777365724F766572726964653D3B20657870697265733D5475652C
2032372D4175672D323031332030353A30383A353920474D543B20706174683D
2F0D0A446174653A205765642C2032382041756720323031332030353A30383A
353820474D540D0A436F6E6E656374696F6E3A20636C6F73650D0A436F6E7465
6E742D4C656E6774683A20313831350D0A0D0A7B226576656E7473223A5B0D0A
7B226576656E745F74797065223A312C2274696D655F7374616D70223A313337
373636363330342C22636F6E74656E74223A2248656C7020636F6D7075746572
21222C22757365725F6964223A323536323731312C22757365725F6E616D6522
3A226B65616C697374222C22726F6F6D5F6964223A3239312C226D6573736167
655F6964223A31313437363638337D2C0D0A7B226576656E745F74797065223A
312C2274696D655F7374616D70223A313337373636363430332C22636F6E7465
6E74223A22405265626F6C426F742068656C70222C22757365725F6964223A32
3536323731312C22757365725F6E616D65223A226B65616C697374222C22726F
6F6D5F6964223A3239312C226D6573736167655F6964223A3131343736373039
2C22706172656E745F6964223A31313436363133377D2C0D0A7B226576656E74
5F74797065223A312C2274696D655F7374616D70223A31333737363636343035
2C22636F6E74656E74223A225C753030336364697620636C6173733D5C753030
32377061727469616C5C75303032375C75303033654920726573706F6E642074
6F20746865736520636F6D6D616E6473205C753030336362725C753030336520
4E6F74653A205B5D206D65616E73206F7074696F6E616C20696E707574206F72
2073686F77732065787065637465642064617461747970652C20287C29206D65
616E732063686F6963653A205C753030336362725C75303033652028646F7C64
6F2F327C646F2F7265647C646F2F626F726F6E292065787072657373696F6E20
5C753030323671756F743B6576616C7561746573205265626F6C2F5265626F6C
2D6C696B652065787072657373696F6E20696E20612073616E64626F78656420
696E7465727072657465725C753030323671756F743B205C753030336362725C
7530303365202868697C68656C6C6F7C676F6F646E696768747C676F6F646279
657C6279657C5B676F6F645D5B6E696768747C6D6F726E696E677C6166746572
6E6F6F6E7C6576656E696E675D2920736F6D652D74657874205C753030323671
756F743B72657475726E732061206772656574696E6720746F20746865207573
65722077686F206772656574656420626F745C753030323671756F743B205C75
3030336362725C7530303365206363206964205C753030323671756F743B7265
747269657665732063757265636F646520646174615C753030323671756F743B
205C753030336362725C75303033652064656C657465205B206C6F7564205D20
5C753030323671756F743B696E207265706C7920746F206120626F74206D6573
736167652077696C6C2064656C65746520696620696E2074696D655C75303032
3671756F743B205C753030336362725C753030336520646F2F6964656F6E6520
77686963682D6C616E67205B776F72642120737472696E672120696E74656765
72215D2065787072657373696F6E205C753030323671756F743B6576616C7561
746573206120736F757263652065787072657373696F6E20666F722074686520
737065636966696564206C616E67756167655C753030323671756F743B5C7530
3033632F6469765C7530303365222C22757365725F6964223A32313039383833
2C22757365725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363731312C22706172
656E745F6964223A31313437363730392C2273686F775F706172656E74223A74
7275657D2C0D0A7B226576656E745F74797065223A312C2274696D655F737461
6D70223A313337373636363439382C22636F6E74656E74223A22405265626F6C
426F742073617665205C753030323671756F743B68656C7020636F6D70757465
725C753030323671756F743B205C753030323671756F743B5C75303032367175
6F743B20687474703A2F2F7777772E796F75747562652E636F6D2F7761746368
3F763D6961733331427936304E38222C22757365725F6964223A323536323731
312C22757365725F6E616D65223A226B65616C697374222C22726F6F6D5F6964
223A3239312C226D6573736167655F6964223A31313437363733352C22706172
656E745F6964223A31313437363731317D2C0D0A7B226576656E745F74797065
223A312C2274696D655F7374616D70223A313337373636363530302C22636F6E
74656E74223A22406B65616C697374206164646564206B65793A2068656C7020
636F6D7075746572222C22757365725F6964223A323130393838332C22757365
725F6E616D65223A225265626F6C426F74222C22726F6F6D5F6964223A323931
2C226D6573736167655F6964223A31313437363733362C22706172656E745F69
64223A31313437363733352C2273686F775F706172656E74223A747275657D5D
2C2274696D65223A32323830393236322C2273796E63223A3133373736363635
33392C226D73223A307D
}]